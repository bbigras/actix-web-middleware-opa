<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="453px" preserveAspectRatio="none" style="width:683px;height:453px;" version="1.1" viewBox="0 0 683 453" width="683px" zoomAndPan="magnify"><defs><filter height="300%" id="f135fuj5yafy9h" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster Application--><polygon fill="#FFC0CB" filter="url(#f135fuj5yafy9h)" points="22,154,115,154,122,176.2969,661,176.2969,661,441,22,441,22,154" style="stroke: #000000; stroke-width: 2.0;"/><line style="stroke: #000000; stroke-width: 2.0;" x1="22" x2="122" y1="176.2969" y2="176.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="26" y="168.9951">Application</text><!--cluster actix-web App--><polygon fill="#FFFFFF" filter="url(#f135fuj5yafy9h)" points="302,197,421,197,428,219.2969,637,219.2969,637,417,302,417,302,197" style="stroke: #000000; stroke-width: 2.0;"/><line style="stroke: #000000; stroke-width: 2.0;" x1="302" x2="428" y1="219.2969" y2="219.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="306" y="211.9951">actix-web App</text><!--entity OPA--><rect fill="#FEFECE" filter="url(#f135fuj5yafy9h)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="38" y="355"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="184" y="360"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="182" y="362"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="182" y="366"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="53" y="387.9951">Open Policy Agent</text><!--entity App--><rect fill="#FEFECE" filter="url(#f135fuj5yafy9h)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="427.5" y="232"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="474.5" y="237"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="472.5" y="239"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="472.5" y="243"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="442.5" y="264.9951">App</text><!--entity Middleware--><rect fill="#FEFECE" filter="url(#f135fuj5yafy9h)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="318" y="355"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="416" y="360"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="414" y="362"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="414" y="366"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="333" y="387.9951">Middleware</text><!--entity Service--><rect fill="#FEFECE" filter="url(#f135fuj5yafy9h)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="531" y="355"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="601" y="360"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="599" y="362"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="599" y="366"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="546" y="387.9951">Service</text><!--entity User--><ellipse cx="461" cy="18" fill="#FEFECE" filter="url(#f135fuj5yafy9h)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M461,26 L461,53 M448,34 L474,34 M461,53 L448,68 M461,53 L474,68 " fill="#FEFECE" filter="url(#f135fuj5yafy9h)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="445" y="87.9951">User</text><!--link User to App--><path d="M444.922,66.802 C432.978,80.131 417.651,100.126 411,121 C399.058,158.481 421.396,200.875 439.94,227.517 " fill="none" id="User-App" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="442.877,231.655,440.929,222.0007,439.9827,227.5779,434.4056,226.6316,442.877,231.655" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="412" y="134.0669">Request</text><!--link User to App--><path d="M466.943,96.164 C467.8,104.416 468.545,112.954 469,121 C471.207,160.031 467.014,205.491 463.909,231.882 " fill="none" id="User-App" style="stroke: #008000; stroke-width: 1.0;"/><polygon fill="#008000" points="466.397,91.069,463.3789,100.444,466.9299,96.0405,471.3334,99.5914,466.397,91.069" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="470" y="134.0669">Response</text><!--link App to Middleware--><path d="M427.284,264.376 C405.065,271.839 377.64,285.211 364,308 C356.473,320.576 358.884,336.559 363.558,349.975 " fill="none" id="App-Middleware" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="365.368,354.791,365.9466,344.9592,363.6093,350.1105,358.4579,347.7732,365.368,354.791" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="365" y="321.0669">Request</text><!--link App to Middleware--><path d="M447.454,282.814 C440.44,295.91 431.39,311.677 422,325 C414.779,335.247 405.911,345.836 397.962,354.763 " fill="none" id="App-Middleware" style="stroke: #FF0000; stroke-width: 1.0;"/><polygon fill="#FF0000" points="449.943,278.119,442.1922,284.1956,447.6001,282.5361,449.2596,287.9441,449.943,278.119" style="stroke: #FF0000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="434" y="321.0669">If denied</text><!--link Middleware to OPA--><path d="M317.99,395.0205 C312.12,396.2326 306.219,397.2648 300.5,398 C265.675,402.477 256.442,401.443 221.5,398 C217.517,397.6075 213.457,397.1295 209.365,396.584 " fill="none" id="Middleware-OPA" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="204.169,395.8584,212.5294,401.0646,209.121,396.5498,213.6357,393.1414,204.169,395.8584" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="222.5" y="394.0669">Policy check</text><!--link Middleware to OPA--><path d="M312.583,378 C279.701,378 239.316,378 204.116,378 " fill="none" id="Middleware-OPA" style="stroke: #008000; stroke-width: 1.0;"/><polygon fill="#008000" points="317.794,378,308.794,374,312.794,378,308.794,382,317.794,378" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="215" y="371.0669">Policy decision</text><!--link Middleware to Service--><path d="M436.168,378 C464.75,378 498.677,378 525.954,378 " fill="none" id="Middleware-Service" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="530.967,378,521.967,374,525.967,378,521.967,382,530.967,378" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="454.5" y="371.0669">If allowed</text><!--link App to Service--><path d="M485.59,281.873 C506.255,303.616 535.47,334.355 555.041,354.947 " fill="none" id="App-Service" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="482.093,278.193,485.3934,287.4724,485.5374,281.8174,491.1924,281.9614,482.093,278.193" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="526" y="321.0669">Response</text><!--
@startuml

skinparam componentStyle uml2

actor User

package "Application" #Pink {
  package "actix-web App" #White {
    component "App" as App
    component "Middleware" as Middleware
    component "Service" as Service
  }
  component "Open Policy Agent" as OPA
}

User -d-> App #Blue : Request
App -d-> Middleware #Blue : Request
Middleware -r-> OPA #Blue : Policy check
OPA -l-> Middleware #Green : Policy decision
Middleware -u-> App #Red : If denied
Middleware -r-> Service #Blue : If allowed
Service -l-> App #Blue : Response
App -u-> User #Green : Response

@enduml

PlantUML version 1.2017.19(Sun Nov 12 22:46:22 AEDT 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_191-b12
Operating System: Linux
OS Version: 4.4.0-139-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>