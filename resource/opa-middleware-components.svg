<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="453px" preserveAspectRatio="none" style="width:583px;height:453px;" version="1.1" viewBox="0 0 583 453" width="583px" zoomAndPan="magnify"><defs><filter height="300%" id="f4u050xkzpi7d" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--cluster Application--><polygon fill="#FFC0CB" filter="url(#f4u050xkzpi7d)" points="22,154,115,154,122,176.2969,561,176.2969,561,441,22,441,22,154" style="stroke: #000000; stroke-width: 2.0;"/><line style="stroke: #000000; stroke-width: 2.0;" x1="22" x2="122" y1="176.2969" y2="176.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="87" x="26" y="168.9951">Application</text><!--cluster actix-web App--><polygon fill="#FFFFFF" filter="url(#f4u050xkzpi7d)" points="220,197,339,197,346,219.2969,537,219.2969,537,417,220,417,220,197" style="stroke: #000000; stroke-width: 2.0;"/><line style="stroke: #000000; stroke-width: 2.0;" x1="220" x2="346" y1="219.2969" y2="219.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="224" y="211.9951">actix-web App</text><!--entity OPA--><rect fill="#FEFECE" filter="url(#f4u050xkzpi7d)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="166" x="38" y="355"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="184" y="360"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="182" y="362"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="182" y="366"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="53" y="387.9951">Open Policy Agent</text><!--entity App--><rect fill="#FEFECE" filter="url(#f4u050xkzpi7d)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="424.5" y="232"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="471.5" y="237"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="469.5" y="239"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="469.5" y="243"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="439.5" y="264.9951">App</text><!--entity Middleware--><rect fill="#FEFECE" filter="url(#f4u050xkzpi7d)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="318" y="355"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="416" y="360"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="414" y="362"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="414" y="366"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="78" x="333" y="387.9951">Middleware</text><!--entity Service--><rect fill="#FEFECE" filter="url(#f4u050xkzpi7d)" height="46.2969" style="stroke: #A80036; stroke-width: 1.5;" width="90" x="236" y="232"/><rect fill="#FEFECE" height="10" style="stroke: #A80036; stroke-width: 1.5;" width="15" x="306" y="237"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="304" y="239"/><rect fill="#FEFECE" height="2" style="stroke: #A80036; stroke-width: 1.5;" width="4" x="304" y="243"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="50" x="251" y="264.9951">Service</text><!--entity User--><ellipse cx="458" cy="18" fill="#FEFECE" filter="url(#f4u050xkzpi7d)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M458,26 L458,53 M445,34 L471,34 M458,53 L445,68 M458,53 L471,68 " fill="#FEFECE" filter="url(#f4u050xkzpi7d)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="32" x="442" y="87.9951">User</text><!--link User to App--><path d="M441.922,66.802 C429.978,80.131 414.651,100.126 408,121 C396.058,158.481 418.396,200.875 436.94,227.517 " fill="none" id="User-App" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="439.877,231.655,437.929,222.0007,436.9827,227.5779,431.4056,226.6316,439.877,231.655" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="409" y="134.0669">Request</text><!--link User to App--><path d="M463.943,96.164 C464.8,104.416 465.545,112.954 466,121 C468.207,160.031 464.014,205.491 460.909,231.882 " fill="none" id="User-App" style="stroke: #008000; stroke-width: 1.0;"/><polygon fill="#008000" points="463.397,91.069,460.3789,100.444,463.9299,96.0405,468.3334,99.5914,463.397,91.069" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="467" y="134.0669">Response</text><!--link App to Middleware--><path d="M450.718,278.186 C445.542,292.259 437.781,310.484 428,325 C421.806,334.192 413.875,343.186 406.122,351.04 " fill="none" id="App-Middleware" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="402.338,354.8,411.5411,351.2923,405.8842,351.2752,405.9014,345.6184,402.338,354.8" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="52" x="439" y="321.0669">Request</text><!--link App to Middleware--><path d="M419.533,266.794 C399.197,274.674 376.014,287.624 364,308 C355.642,322.176 359.714,340.589 365.431,354.828 " fill="none" id="App-Middleware" style="stroke: #FF0000; stroke-width: 1.0;"/><polygon fill="#FF0000" points="424.361,264.995,414.5308,264.3888,419.6756,266.7406,417.3238,271.8854,424.361,264.995" style="stroke: #FF0000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="54" x="365" y="321.0669">If denied</text><!--link Middleware to OPA--><path d="M317.99,395.0205 C312.12,396.2326 306.219,397.2648 300.5,398 C265.675,402.477 256.442,401.443 221.5,398 C217.517,397.6075 213.457,397.1295 209.365,396.584 " fill="none" id="Middleware-OPA" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="204.169,395.8584,212.5294,401.0646,209.121,396.5498,213.6357,393.1414,204.169,395.8584" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="222.5" y="394.0669">Policy check</text><!--link Middleware to OPA--><path d="M312.583,378 C279.701,378 239.316,378 204.116,378 " fill="none" id="Middleware-OPA" style="stroke: #008000; stroke-width: 1.0;"/><polygon fill="#008000" points="317.794,378,308.794,374,312.794,378,308.794,382,317.794,378" style="stroke: #008000; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="215" y="371.0669">Policy decision</text><!--link Service to Middleware--><path d="M280.157,283.467 C280.976,296.97 283.898,312.898 292,325 C300.18,337.219 312.299,347.057 324.839,354.747 " fill="none" id="Service-Middleware" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="279.935,278.233,276.3217,287.3951,280.1478,283.2285,284.3145,287.0546,279.935,278.233" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="58" x="293" y="321.0669">If allowed</text><!--link Service to App--><path d="M326.123,255 C354.953,255 391.942,255 419.406,255 " fill="none" id="Service-App" style="stroke: #0000FF; stroke-width: 1.0;"/><polygon fill="#0000FF" points="424.419,255,415.419,251,419.419,255,415.419,259,424.419,255" style="stroke: #0000FF; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="62" x="344.25" y="248.0669">Response</text><!--
@startuml

skinparam componentStyle uml2

actor User

package "Application" #Pink {
  package "actix-web App" #White {
    component "App" as App
    component "Middleware" as Middleware
    component "Service" as Service
  }
  component "Open Policy Agent" as OPA
}

User -d-> App #Blue : Request
App -d-> Middleware #Blue : Request
Middleware -r-> OPA #Blue : Policy check
OPA -l-> Middleware #Green : Policy decision
Middleware -u-> App #Red : If denied
Middleware -l-> Service #Blue : If allowed
Service -r-> App #Blue : Response
App -u-> User #Green : Response

@enduml

PlantUML version 1.2017.19(Sun Nov 12 22:46:22 AEDT 2017)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Java Version: 1.8.0_191-b12
Operating System: Linux
OS Version: 4.4.0-139-generic
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>